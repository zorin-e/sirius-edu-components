import{defineComponent as e,inject as t,toRefs as n,ref as r,computed as o,onMounted as a,onUnmounted as l,watch as s,resolveDirective as i,openBlock as u,createElementBlock as d,normalizeClass as c,withDirectives as m,createElementVNode as v,normalizeStyle as _,Fragment as p,renderList as g,renderSlot as h}from"vue";import{isMobile as f,clamp as y}from"@smartmed/webpatient-vue-components/domain";import{DragDropDirective as b,IntersectionDirective as w}from"@smartmed/webpatient-vue-components/directives";import{EVENT_TUNNEL_TOKEN as E}from"@smartmed/webpatient-vue-components/tokens";import{throttle as x}from"@smartmed/webpatient-vue-components/infrastructure";var L=e({name:"Carousel",props:{modelValue:{type:Number,required:!0},itemsCount:{type:Number,required:!0},items:{type:Array,required:!0},draggable:{type:Boolean},autoScrollLooping:{type:Boolean}},directives:{"drag-drop":b,intersection:w,"carousel-scroll":{beforeMount(e,{value:t}){const n=x((e=>{t.onEvent(e)}),500),r=({deltaX:t})=>{Math.abs(t)<=20||(n(Math.sign(t)),e.scrollLeft=10)};f()||(e.addEventListener("wheel",r),e.__smartmed_carouselScroll__=r)},beforeUnmount(e){e.__smartmed_carouselScroll__&&e.removeEventListener("wheel",e.__smartmed_carouselScroll__)}}},setup(e,{emit:i}){const u=t(E,null),{itemsCount:d,modelValue:c,items:m,draggable:v,autoScrollLooping:_}=n(e),p=r(!0),g=r(0),h=r(null),b=r(null),w=o((()=>{const e=100/d.value+"%";return{minWidth:e,maxWidth:e,flexBasis:e}})),x=o((()=>-c.value/d.value)),L=o((()=>({transform:`translateX(${100*(p.value?x.value:g.value)}%)`}))),S=o((()=>f()||v.value));a((()=>{const e=h.value;e&&(e.addEventListener("touchstart",M),e.addEventListener("touchend",k),e.addEventListener("mousedown",M),document.addEventListener("mouseup",k))})),l((()=>{const e=h.value;e&&(e.removeEventListener("touchstart",M),e.removeEventListener("touchend",k),e.removeEventListener("mousedown",M),document.removeEventListener("mouseup",k))})),u&&s(u,(()=>{C()}));const $=e=>{const t=m.value.length>=d.value?d.value:m.value.length;i("update:modelValue",y(e,0,m.value.length-t))};s(d,(()=>{$(0)}));const C=()=>{const e=c.value===m.value.length-1?0:c.value+1,t=_.value?e:y(c.value+1,0,m.value.length-1);$(t),_.value||t!==m.value.length-1||i("autoscroll-end")},M=()=>{p.value=!1,g.value=x.value},k=()=>{p.value=!0};return{computedStyle:w,transform:L,transitioned:p,onDragDrop:(e,[t])=>{if(!S.value)return;const{clientWidth:n}=e,r=1-m.value.length/d.value;g.value=y(t/n+g.value,r,0)},host:h,onIntersect:(e,{intersectionRatio:t})=>{t&&1!==t&&!p.value&&$(e-Math.floor(d.value/2))},intersectionRoot:b,onScroll:e=>{$(c.value+e)},next:()=>{$(c.value+1)},prev:()=>{$(c.value-1)}}}});!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}('._container_uernr_1 {\n  position: relative;\n  display: block;\n  overflow: hidden;\n}\n._container_draggable_uernr_6 {\n  user-select: none;\n}\n._container_draggable_uernr_6:hover {\n  cursor: grab;\n}\n._container_draggable_uernr_6:active {\n  cursor: grabbing;\n}\n._scroller_uernr_16 {\n  display: flex;\n  overflow: auto;\n  overscroll-behavior-x: none;\n  padding-bottom: 2rem;\n  margin-bottom: -2rem;\n}\n._scroller_uernr_16:before, ._scroller_uernr_16:after {\n  content: "";\n  display: block;\n  min-width: 1rem;\n}\n._items_uernr_29 {\n  display: flex;\n  align-items: center;\n}\n._items_transitioned_uernr_33 {\n  transition: transform 0.4s ease;\n}\n._wrapper_uernr_37 {\n  position: sticky;\n  left: 0;\n  right: 0;\n  min-width: 100%;\n  overflow: hidden;\n}\n._item_uernr_29 {\n  padding: 0 8px;\n}');(L.__cssModules={}).$style={container:"_container_uernr_1",container_draggable:"_container_draggable_uernr_6",scroller:"_scroller_uernr_16",items:"_items_uernr_29",items_transitioned:"_items_transitioned_uernr_33",wrapper:"_wrapper_uernr_37",item:"_item_uernr_29"},L.render=function(e,t,n,r,o,a){const l=i("intersection"),s=i("drag-drop"),f=i("carousel-scroll");return u(),d("div",{ref:"host",ondragstart:"return false;",class:c([e.$style.container,e.draggable&&e.$style.container_draggable])},[m((u(),d("div",{class:c(e.$style.scroller)},[v("div",{class:c(e.$style.wrapper)},[m((u(),d("div",{class:c([e.$style.items,e.transitioned&&e.$style.items_transitioned]),style:_(e.transform)},[(u(!0),d(p,null,g(e.items,((t,n)=>m((u(),d("div",{key:t,style:_(e.computedStyle),class:c(e.$style.item)},[h(e.$slots,"default",{item:t})],6)),[[l,{options:{threshold:[.01,.01],rootMargin:"100px 100000px 100px -51%",root:()=>e.$refs.host},disconnectAfterIntersect:!1,isObserve:!0,onIntersect:e.onIntersect.bind(null,n)}]]))),128))],6)),[[s,{onEvent:e.onDragDrop}]])],2)],2)),[[f,{onEvent:e.onScroll}]])],2)};export{L as default};
