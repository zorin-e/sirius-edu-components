"use strict";var e=require("vue"),t=require("text-mask-core"),a=require("@smartmed/webpatient-vue-components/domain"),n=require("@smartmed/webpatient-vue-components/tokens");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=o(require("@smartmed/webpatient-vue-components/BaseInput"));const r=/[ \-_]/g,s="+7 ".length,u={mask:[..."+7 ".split(""),/[1-9]/,/\d/,/\d/," ",/\d/,/\d/,/\d/,"-",/\d/,/\d/,"-",/\d/,/\d/],pipe:e=>""===e?"+7 ":e.replace(/[- ]$/,""),guide:!1};var i=e.defineComponent({inheritAttrs:!1,components:{BaseInput:l.default},name:"InputPhone",props:{modelValue:{type:String,required:!0},disabled:Boolean},setup(o,{emit:l}){const{modelValue:i,disabled:d}=e.toRefs(o),p=e.inject(n.SELECTION_CHANGE_TOKEN),c=e.ref(null),m=e.computed((()=>{const e=i.value.replace(/^7/,"")||"+7 ",{conformedValue:a}=t.conformToMask(e,u.mask,{guide:!1});return a.replace(/[- ]$/,"")})),v=e.computed((()=>c.value&&c.value.$refs.native.$refs.native)),f=e=>{l("update:modelValue",e)},g=e=>{const t=i.value.length>1&&i.value.length<11,a=e.replace(r,"").length,n=e.replace(/[^0-9]+/g,""),o=String(getSelection()).length;return t&&0===o?`${i.value}${n}`.slice(0,13):a<10?`7${n}`.slice(0,11):`7${n.replace(/^7|^8/,"")}`.slice(0,11)},b=()=>{(()=>{if(!v.value||!c.value)return!1;const{selectionStart:e,selectionEnd:t}=v.value;return c.value.focused&&null!==e&&e<s&&e===t})()&&v.value&&v.value.setSelectionRange(s,s,"none")};return e.watch(i,(e=>{if(e&&11===e.length&&e.startsWith("8")){const t=g(e);f(t)}}),{immediate:!0}),p&&e.watch(p,(()=>{b()})),{baseInput:c,formattedValue:m,onBackspace:e=>{(e.target.selectionStart||0)<=s&&e.target.selectionStart===e.target.selectionEnd&&e.preventDefault()},onPaste:e=>{if(d.value)return;const t=a.getClipboardDataText(e).replace(/^\+?7|8/,""),n=g(t);f(n)},maskOptions:u,updateValue:f}}});i.render=function(t,a,n,o,l,r){const s=e.resolveComponent("base-input");return e.openBlock(),e.createBlock(s,e.mergeProps(t.$attrs,{autocomplete:"tel","data-automation-id":"smed-input-phone",ref:"baseInput",type:"tel",name:"tel",modelValue:t.formattedValue,"mask-options":t.maskOptions,disabled:t.disabled,onPaste:e.withModifiers(t.onPaste,["prevent"]),"onUpdate:modelValue":t.updateValue,onKeydown:e.withKeys(t.onBackspace,["backspace"])}),null,16,["modelValue","mask-options","disabled","onPaste","onUpdate:modelValue","onKeydown"])},module.exports=i;
