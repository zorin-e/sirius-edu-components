"use strict";var e,t,o=require("vue");!function(e){e.FRONT="FRONT",e.BEHIND="BEHIND"}(e||(e={})),function(e){e.INIT="INIT",e.FIXED="FIXED",e.DYNAMIC="DYNAMIC"}(t||(t={}));const a=(o,a)=>{const i={range:{},sizes:new Map,firstRangeTotalSize:0,firstRangeAverageSize:0,lastCalcIndex:0,fixedSizeValue:0,calcType:t.INIT,direction:null,param:o,callUpdate:a,offset:0,destroy(){this.range={},this.sizes=new Map,this.firstRangeTotalSize=0,this.firstRangeAverageSize=0,this.lastCalcIndex=0,this.fixedSizeValue=0,this.calcType=t.INIT,this.offset=0,this.direction=null},getRange(){const{start:e,end:t,padFront:o,padBehind:a}=this.range;return{start:e,end:t,padFront:o,padBehind:a}},isBehind(){return this.direction===e.BEHIND},isFront(){return this.direction===e.FRONT},getOffset(e){return(e<1?0:this.getIndexOffset(e))+this.param.slotHeaderSize},updateParam(e,t){this.param&&e in this.param&&("uniqueIds"===e&&this.sizes.forEach(((e,o)=>{!t.includes(o)&&this.sizes.delete(o)})),this.param[e]=t)},saveSize(e,o){this.sizes.set(e,o),this.calcType===t.INIT?(this.fixedSizeValue=o,this.calcType=t.FIXED):this.calcType===t.FIXED&&this.fixedSizeValue!==o&&(this.calcType=t.DYNAMIC,this.fixedSizeValue=null),this.calcType!==t.FIXED&&void 0!==this.firstRangeTotalSize&&(this.sizes.size<Math.min(this.param.keeps,this.param.uniqueIds.length)?(this.firstRangeTotalSize=[...this.sizes.values()].reduce(((e,t)=>e+t),0),this.firstRangeAverageSize=Math.round(this.firstRangeTotalSize/this.sizes.size)):this.firstRangeTotalSize=null)},handleItemsChange(){let e=this.range.start;this.isFront()?e-=5:this.isBehind()&&(e+=5),e=Math.max(e,0),this.updateRange(this.range.start,this.getEndByStart(e))},handleSlotSizeChange(){this.handleItemsChange()},handleScroll(t){this.direction=t<this.offset?e.FRONT:e.BEHIND,this.offset=t,this.param&&(this.direction===e.FRONT?this.handleFront():this.direction===e.BEHIND&&this.handleBehind())},handleFront(){const e=this.getScrollOvers();if(this.range.start&&e>this.range.start)return;const t=Math.max(e-this.param.buffer,0);this.checkRange(t,this.getEndByStart(t))},handleBehind(){const e=this.getScrollOvers();this.range.start&&e<this.range.start+this.param.buffer||this.checkRange(e,this.getEndByStart(e))},getScrollOvers(){const e=this.offset-this.param.slotHeaderSize;if(e<=0)return 0;if(this.isFixedType())return Math.floor(e/this.fixedSizeValue);let t=0,o=0,a=0,i=this.param.uniqueIds.length;for(;t<=i;){if(o=t+Math.floor((i-t)/2),a=this.getIndexOffset(o),a===e)return o;a<e?t=o+1:a>e&&(i=o-1)}return t>0?--t:0},getIndexOffset(e){if(!e)return 0;let t,o=0;for(let a=0;a<e;a++)t=this.sizes.get(this.param.uniqueIds[a]),o+="number"==typeof t?t:this.getEstimateSize();return this.lastCalcIndex=Math.max(this.lastCalcIndex,e-1),this.lastCalcIndex=Math.min(this.lastCalcIndex,this.getLastIndex()),o},isFixedType(){return this.calcType===t.FIXED},getLastIndex(){return this.param.uniqueIds.length-1},checkRange(e,t){const o=this.param.keeps;this.param.uniqueIds.length<=o?(e=0,t=this.getLastIndex()):t-e<o-1&&(e=t-o+1),this.range.start!==e&&this.updateRange(e,t)},updateRange(e,t){this.range.start=e,this.range.end=t,this.range.padFront=this.getPadFront(),this.range.padBehind=this.getPadBehind(),this.callUpdate(this.getRange())},getEndByStart(e){const t=e+this.param.keeps-1;return Math.min(t,this.getLastIndex())},getPadFront(){return this.isFixedType()?this.fixedSizeValue*this.range.start:this.getIndexOffset(this.range.start)},getPadBehind(){const e=this.range.end,t=this.getLastIndex();return this.isFixedType()?(t-e)*this.fixedSizeValue:this.lastCalcIndex===t?this.getIndexOffset(t)-this.getIndexOffset(e):(t-e)*this.getEstimateSize()},getEstimateSize(){return this.isFixedType()?this.fixedSizeValue:this.firstRangeAverageSize||this.param.estimateSize}};return o&&i.checkRange(0,o.keeps-1),i};var i=o.defineComponent({name:"VirtualListItem",props:{horizontal:{type:Boolean}},setup(e,t){const{horizontal:a}=o.toRefs(e),i=o.ref(null);let s=null;const n=o.computed((()=>a.value?"offsetWidth":"offsetHeight"));o.onMounted((()=>{"undefined"!=typeof ResizeObserver&&i.value&&(s=new ResizeObserver((()=>{r()})),s.observe(i.value))}));const r=()=>{t.emit("item-resize",l())},l=()=>i.value?i.value[n.value]:0;return o.onUpdated((()=>{r()})),o.onBeforeUnmount((()=>{s&&(s.disconnect(),s=null)})),{root:i}}});const s={ref:"root",role:"listitem"};var n;i.render=function(e,t,a,i,n,r){return o.openBlock(),o.createElementBlock("div",s,[o.renderSlot(e.$slots,"default")],512)},function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(n||(n={}));var r=o.defineComponent({components:{Item:i},name:"VirtualList",props:{items:{type:Array,required:!0},dataKey:{type:String,required:!0,default:"id"},keeps:{type:Number,default:50},estimateSize:{type:Number,default:50},pageMode:{type:Boolean},direction:{type:String,validator:e=>Object.values(n).includes(e),default:n.VERTICAL},start:{type:Number,default:0},offset:{type:Number,default:0},topThreshold:{type:Number,default:0},bottomThreshold:{type:Number,default:0}},setup(e,t){const{dataKey:i,items:s,direction:r,start:l,offset:d,topThreshold:u,bottomThreshold:h,keeps:c,pageMode:p}=o.toRefs(e),f=o.ref({}),m=o.ref(null),g=o.ref(null),v=o.computed((()=>s.value.map((e=>e[i.value])))),z=o.computed((()=>r.value===n.HORIZONTAL)),S=o.computed((()=>z.value?"scrollLeft":"scrollTop")),_=a({slotHeaderSize:0,slotFooterSize:0,keeps:e.keeps,estimateSize:e.estimateSize,buffer:Math.round(e.keeps/3),uniqueIds:v.value},(e=>{f.value=e}));o.onBeforeMount((()=>{k(_.offset)})),o.onMounted((()=>{l.value?x(l.value):d.value&&k(d.value),p.value&&(B(),document.addEventListener("scroll",E,{passive:!1}))}));const x=e=>{if(e>=s.value.length-1)I();else{const t=_.getOffset(e);k(t)}},I=()=>{if(g.value){const e=g.value[z.value?"offsetLeft":"offsetTop"];k(e),setTimeout((()=>{y()+T()<R()&&I()}))}},y=()=>p.value?document.documentElement[S.value]||document.body[S.value]:m.value?Math.ceil(m.value[S.value]):0,T=()=>{const e=z.value?"clientWidth":"clientHeight";return p.value?document.documentElement[e]||document.body[e]:m.value?Math.ceil(m.value[e]):0},R=()=>{const e=z.value?"scrollWidth":"scrollHeight";return p.value?document.documentElement[e]||document.body[e]:m.value?Math.ceil(m.value[e]):0},k=e=>{if(p.value)return document.body[S.value]=e,void(document.documentElement[S.value]=e);m.value&&(m.value[S.value]=e)},B=()=>{if(!m.value)return;const e=m.value.getBoundingClientRect(),{defaultView:t}=m.value.ownerDocument;if(t){const o=z.value?e.left+t.pageXOffset:e.top+t.pageYOffset;_.updateParam("slotHeaderSize",o)}},E=()=>{const e=y(),o=T(),a=R();e<0||e+o>a+1||!a||(_.handleScroll(e),((e,o,a)=>{_.isFront()&&s.value.length&&e-u.value<=0?t.emit("totop"):_.isBehind()&&e+o+h.value>=a&&t.emit("tobottom")})(e,o,a))};o.onBeforeUnmount((()=>{_.destroy(),p.value&&document.removeEventListener("scroll",E)}));const N=o.computed((()=>{const{padBehind:e,padFront:t}=f.value;return{padding:z.value?`0px ${e}px 0px ${t}px`:`${t}px 0px ${e}px`}})),b=o.computed((()=>{const{start:e,end:t}=f.value;return void 0===e||void 0===t?s.value:s.value.slice(e,t+1)}));return o.watch(c,(e=>{_.updateParam("keeps",e),_.handleSlotSizeChange()})),o.watch(l,(e=>{x(e)})),o.watch(d,(e=>{k(e)})),o.watch(s,(()=>{_.updateParam("uniqueIds",v.value),_.handleItemsChange()})),{root:m,shepherd:g,onScroll:E,groupStyle:N,isHorizontal:z,range:f,computedItems:b,onItemResized:(e,t)=>{_.saveSize(e,t)},onSlotResized:(e,t)=>{_.updateParam(e,t)},scrollToBottom:I}}});!function(e,t){void 0===t&&(t={});var o=t.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===o&&a.firstChild?a.insertBefore(i,a.firstChild):a.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}("._rootScrollable_horizontal_1kox7_1 {\n  overflow-x: auto;\n}\n._rootScrollable_vertical_1kox7_4 {\n  overflow-y: auto;\n}\n._root_1kox7_1,\n._group_1kox7_9 {\n  display: flex;\n}\n._root_horizontal_1kox7_12,\n._group_horizontal_1kox7_13 {\n  flex-direction: row;\n}\n._root_vertical_1kox7_16,\n._group_vertical_1kox7_17 {\n  flex-direction: column;\n}");(r.__cssModules={}).$style={rootScrollable_horizontal:"_rootScrollable_horizontal_1kox7_1",rootScrollable_vertical:"_rootScrollable_vertical_1kox7_4",root:"_root_1kox7_1",group:"_group_1kox7_9",root_horizontal:"_root_horizontal_1kox7_12",group_horizontal:"_group_horizontal_1kox7_13",root_vertical:"_root_vertical_1kox7_16",group_vertical:"_group_vertical_1kox7_17"},r.render=function(e,t,a,i,s,n){const r=o.resolveComponent("item");return o.openBlock(),o.createElementBlock("div",{ref:"root",class:o.normalizeClass([!e.pageMode&&e.$style.rootScrollable,!e.pageMode&&e.$style["rootScrollable_"+e.direction],e.$style.root,e.$style["root_"+e.direction]]),onScroll:t[2]||(t[2]=t=>!e.pageMode&&e.onScroll(t))},[o.createVNode(r,{onItemResize:t[0]||(t[0]=t=>e.onSlotResized("slotHeaderSize",t))},{default:o.withCtx((()=>[o.renderSlot(e.$slots,"before")])),_:3}),o.createElementVNode("div",{role:"group",class:o.normalizeClass([e.$style.group,e.$style["group_"+e.direction]]),style:o.normalizeStyle(e.groupStyle)},[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(e.computedItems,(t=>(o.openBlock(),o.createBlock(r,{key:t[e.dataKey],onItemResize:o=>e.onItemResized(t.id,o)},{default:o.withCtx((()=>[o.renderSlot(e.$slots,"default",{item:t})])),_:2},1032,["onItemResize"])))),128))],6),o.createVNode(r,{onItemResize:t[1]||(t[1]=t=>e.onSlotResized("slotFooterSize",t))},{default:o.withCtx((()=>[o.renderSlot(e.$slots,"after")])),_:3}),o.createElementVNode("div",{ref:"shepherd",style:o.normalizeStyle({width:e.isHorizontal?"0px":"100%",height:e.isHorizontal?"100%":"0px"})},null,4)],34)},module.exports=r;
